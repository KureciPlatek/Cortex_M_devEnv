
# From STM32H7 to STM32F4

Step 1, modify all files

| File                             | aim              | modif                                                                                                                                                                                                                 |
| :------------------------------- | ---------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ./STM32H723.svd                  | For VSCode debug | Select for F411 in STMicroelectronics website, STM32F4, CAD page:<br>[STM32F411 - STMicroelectronics](https://www.st.com/en/microcontrollers-microprocessors/stm32f411.html#cad-resources)<br>Now: STM32F411.svd file |
| ./stm32h7_debug.cfg              |                  |                                                                                                                                                                                                                       |
| startup_stm32f411.s startup file |                  |                                                                                                                                                                                                                       |
| linker_flash.ld linker file      |                  |                                                                                                                                                                                                                       |
|                                  |                  |                                                                                                                                                                                                                       |

I still had to create a full STM32F411 project with STM32CubeMX to generate all startup files, first main and clock config, etc... I could have done it manually, but it takes too much time

I had to clone the STM32F4 HAL, I took also with examples to go fast with ThreadX: https://github.com/STMicroelectronics/STM32CubeF4.git

Sadly, no example of ThreadX for STM32F411REx, nor there is the source of ThreadX in the CubeF4 repo. So I had to do it myself

For OpenOCD, use the old one and just change which SoC we are using is fully good!

I had to modify timer for HAL to use TIM2.

I had to modify GPIO ports, GPIO RCC and so on to match STM32F411REx's config on Nucleo board.
## Use of ThreadX from its own sources, not HAL CUbe git repo

I had to take the tx_initialize_low_level.S generated by STM32CubeIDE, as it slightly changes from STM32H7 (different interrupt vector table, `SYSTEM_CLOCK` variable, use of `tx_user.h` file and some preprocessor switches)